

## Q1. 동시성 테스트
1. 데이터베이스를 제거하고 테스트해보기, 낙관적 락 비관적 락 쓰는 거 아니니까 실제 동시성 이슈 발생하는 거 확인 먼저 해보기.

## Q2. 낙관적 락과 비관적 락에 대한 개념 유추해보기

- 무엇에 대한 낙관적, 비관적을 의미하는가?
```
락이 필요한 상황에 대한 관점이다.

A. 낙관적 락은 '아~ 락 필요할 일 없어, 그냥 락 필요할 때 사용할게 (CAS)'
B. 비관적 락은 '아~ 나는 다 걱정돼, 매번 락 걸어버릴래'

위 예시를 우산에 빗대어 설명하자.

A. 낙관: 비 안와 짜샤~ (길 가다 비 내리면 우산을 가지러 감)
B. 비관적 락: 오늘 혹시 비가 올지도 몰라 .. (매일 우산을 들고 다님)


이게 낙관적 락과 비관적 락에 대한 좋은 비유다. 낙관적 락은 락이 필요할 일이 없다고 가정하고 락이 필요한 상황에 그 때 해결하는 것 (CAS)이고
비관적 락은 매번 락을 거는 차이다. 
```

<br>

> 1. 일반적이고 추상적으로 표현하자면 비관적 락은 매일 비가 올까 걱정돼 우산을 들고 다니는 상태이기에 비가 많이 오는 경우 유리하다. 단, 비가 적게 오면 괜히 우산만 들고 다니는 셈이 되기에 이 점은 불리하다.
>
> 2. 반대로 낙관적 락은 비가 안올거라고 생각하고 우산을 놓고 다니는 상태이기에 비가 적게 오는 경우 유리하다. 단, 비가 많이 오게 되면 집까지 돌아갔다 와야하기에 이 점은 불리하다.



## Q3. 어플리케이션 모니터링
```
(1) 스카우터
(2) visual vm(?): 정확하지 않음
(3) 프로메테우스
(4) 그라파나
```

## Q4. IaC (Infrastructure as code): 어플리케이션을 서버에 올릴텐데 서버를 누가 어떻게 구성해주냐를 의미 (aws에 EC2 만들고 하는 등의 것들을 코드로 구현하는 것)
```
(1) Terraform
(2) AWS CloudFormation
(3) AWS CDK
(4) Ansible
(5) Chef
```

## Q5. API 게이트웨이

```


```



## 06. 로드 밸런서

```

```



## 07. 분산 캐시 (distributed cache: Redis)
```

```


## 08. 메시지 브로커 (RabbitMQ)
```

```


## 09. 이벤트 브로커 (event broker, Kafka) 
```

```


## 10. 주문 관련 도메인 청사진 [프로젝트]
```
Q1. 주문 서비스와 상품 서비스엔 어떤 기능이 있어야 할까?
= 주문 신청, 주문 조회, 주문 취소 .. (그냥 기본적인 CRUD)


Q2. 그럼 주문 신청의 플로우는 ? [42:00 정리]

1. 재고 체크 > 2. 상품 가져다 놓기(락?) > 3. 결제 > 4. 결제 실패등 재시도 로직 > 5. 배송 시스템에 배송 정보 등록 (주문을 저장하는 것일 수도 있고) > 6. 배송 시스템 실패?

+ 재시도 간간히 체크하며 도입해보기 (실제 슈퍼마켓 일한다고 생각하고 해보기)



Order라는 API 대충 만들고 그 안에 수도 코드로 대충 해놓고 테스트 코드 작성하며 시작하면 그게 TDD
```


## 11. 주문 서비스가 재고 서비스와 연동할 때 어떤 식으로?
```
기본적인 건 레스트 템플릿.

- 레스트 템플릿은 동기다.
- Q1. 만약 이걸 비동기로 만들면 어떤 식으로 구성이 될까?
- A1. 이벤트 발행등을 사용할 수 있을 거 같다.  (이 부분 공부)
- Q2. 재고가 잘 빠졌는지에 대한 답장은?
- A2. 예전 퍼블리셔 서브스크라이버 같이 이벤트 발행시는 퍼블리셔 입장, 답장 받는 건 서브스카리어바 입장이 되서 다른 토픽의 주문 재고를  .. -> 이 내용 이해해보기
- Q3. 이거 잘 고민햐봐야해, 만약 재고 줄여주는 걸 비동기로 해도 고객한테 제공되는 응답이 빨라질까? 
- A3. 아니~ 이런 경우는 굳이 비동기를 해봐도 필요가 없음. 아니면 재고가 미리 구매 버튼을 누르는 순간 확보해버리고 뭐 하는 거 같은 여러 기법들 사용 가능 (코레일 처럼). 하지만 이득이 크진 않다.
- Q4. 다만 마지막 배송처럼 실제 결제 이후에 독립적으로 수행해도 되는 작업은 비동기로 날려도 된다. (이벤트성 메시지 등 ..) => 슈퍼마켓 등에 도입 고려

+ 기본적으로 레스트로 다 써보고 이벤트 브로커, 메시지 브로커 등 고민해보기.
+ 사용자 많아진다고 하면 재고를 분산 캐시로 해서 줄여주고 늘려준다고 하면 부하를 만이 줄일 수도 있으니 고민해보기
```



오늘 하루도 공부할 수 있어 크게 감사합니다. 2024-05-16 개발자 최찬혁
