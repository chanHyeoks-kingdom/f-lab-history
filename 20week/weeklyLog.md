

## Q1. 동시성 테스트
1. 데이터베이스를 제거하고 테스트해보기, 낙관적 락 비관적 락 쓰는 거 아니니까 실제 동시성 이슈 발생하는 거 확인 먼저 해보기.

## Q2. 낙관적 락과 비관적 락에 대한 개념 유추해보기

- 무엇에 대한 낙관적, 비관적을 의미하는가?
```
락이 필요한 상황에 대한 관점이다.

A. 낙관적 락은 '아~ 락 필요할 일 없어, 그냥 락 필요할 때 사용할게 (CAS)'
B. 비관적 락은 '아~ 나는 다 걱정돼, 매번 락 걸어버릴래'

위 예시를 우산에 빗대어 설명하자.

A. 낙관: 비 안와 짜샤~ (길 가다 비 내리면 우산을 가지러 감)
B. 비관적 락: 오늘 혹시 비가 올지도 몰라 .. (매일 우산을 들고 다님)


이게 낙관적 락과 비관적 락에 대한 좋은 비유다. 낙관적 락은 락이 필요할 일이 없다고 가정하고 락이 필요한 상황에 그 때 해결하는 것 (CAS)이고
비관적 락은 매번 락을 거는 차이다. 
```

<br>

> 1. 일반적이고 추상적으로 표현하자면 비관적 락은 매일 비가 올까 걱정돼 우산을 들고 다니는 상태이기에 비가 많이 오는 경우 유리하다. 단, 비가 적게 오면 괜히 우산만 들고 다니는 셈이 되기에 이 점은 불리하다.
>
> 2. 반대로 낙관적 락은 비가 안올거라고 생각하고 우산을 놓고 다니는 상태이기에 비가 적게 오는 경우 유리하다. 단, 비가 많이 오게 되면 집까지 돌아갔다 와야하기에 이 점은 불리하다.



## Q3. 어플리케이션 모니터링
```
(1) 스카우터
(2) visual vm(?): 정확하지 않음
(3) 프로메테우스
(4) 그라파나
```

## Q4. IaC (Infrastructure as code): 어플리케이션을 서버에 올릴텐데 서버를 누가 어떻게 구성해주냐를 의미 (aws에 EC2 만들고 하는 등의 것들을 코드로 구현하는 것)
```
(1) Terraform
(2) AWS CloudFormation
(3) AWS CDK
(4) Ansible
(5) Chef
```

## Q5. API 게이트웨이

```
API GATEWAY는 택배 물류창고 같은 개념입니다. 택배를 보내는 사람이 받는 사람에게 물건을 보낼 때 이걸 관리하는 중앙 저장소 같은 개념입니다. 수하물들은 모두 이곳을 거치기에
중앙 집중화되었다고 표현할 수 있고 이 과정에서 보안상의 이점등을 가질 수 있습니다.
```



## 06. 로드 밸런서

```
은행 창구 안내원 같은 역할이다. 은행에 갔을 때 하나의 창구에만 고객들이 몰리지 않게 여러 창구들에 잘 분산해서 고객을 보내는 것 처럼 로드 밸런서는 많은 요청들을 각각의
서버에 분산해서 보내는 역할을 한다.
```



## 07. 분산 캐시 (distributed cache: Redis)
```
분산 캐시는 하나의 로컬 환경에서 캐시를 관리하는게 불안정하고 확장하기도 어려우니까 캐시 서버를 여러대 두어서 관리하는 방법이다. 딱 봐도 직접 구현하는 건 어렵운듯 하다.
그래서 대부분 레디스 같은 솔루션을 이용한다.
```


## 08. 메시지 브로커 (RabbitMQ)
```
메시지 브로커는 우체부 같은 개념이다. 서버들이 메시지를 주고 받기 위해서 이를 대행해주는 서비스가 필요한데 이 역할을 하는게 메시지 브로커다.
메시지 브로커를 이용하면 비동기 처리, 안정적인 메시지 관리등을 할 수 있고 대표적으로 RabbitMQ등이 있다. (카프카도 Message Broker라고 볼 수 있음)
```


## 09. 이벤트 브로커 (event broker, Kafka) 
```
메시지 브로커와 유사한 역할을 하되, 이벤트라는 컨셉을 이용해 전달하고자 하는 메시지를 이벤트로서 발행, 구독하는 개념이다.
카프카는 
```


## 10. 주문 관련 도메인 청사진 [프로젝트]
```
Q1. 주문 서비스와 상품 서비스엔 어떤 기능이 있어야 할까?
= 주문 신청, 주문 조회, 주문 취소 .. (그냥 기본적인 CRUD)


Q2. 그럼 주문 신청의 플로우는 ? [42:00 정리]

1. 재고 체크 > 2. 상품 가져다 놓기(락?) > 3. 결제 > 4. 결제 실패등 재시도 로직 > 5. 배송 시스템에 배송 정보 등록 (주문을 저장하는 것일 수도 있고) > 6. 배송 시스템 실패?

+ 재시도 간간히 체크하며 도입해보기 (실제 슈퍼마켓 일한다고 생각하고 해보기)



Order라는 API 대충 만들고 그 안에 수도 코드로 대충 해놓고 테스트 코드 작성하며 시작하면 그게 TDD
```


## 11. 주문 서비스가 재고 서비스와 연동할 때 어떤 식으로?
```
기본적인 건 레스트 템플릿.

- 레스트 템플릿은 동기다.
- Q1. 만약 이걸 비동기로 만들면 어떤 식으로 구성이 될까?
- A1. 이벤트 발행등을 사용할 수 있을 거 같다.  (이 부분 공부)
- Q2. 재고가 잘 빠졌는지에 대한 답장은?
- A2. 예전 퍼블리셔 서브스크라이버 같이 이벤트 발행시는 퍼블리셔 입장, 답장 받는 건 서브스카리어바 입장이 되서 다른 토픽의 주문 재고를  .. -> 이 내용 이해해보기
- Q3. 이거 잘 고민햐봐야해, 만약 재고 줄여주는 걸 비동기로 해도 고객한테 제공되는 응답이 빨라질까? 
- A3. 아니~ 이런 경우는 굳이 비동기를 해봐도 필요가 없음. 아니면 재고가 미리 구매 버튼을 누르는 순간 확보해버리고 뭐 하는 거 같은 여러 기법들 사용 가능 (코레일 처럼). 하지만 이득이 크진 않다.
- Q4. 다만 마지막 배송처럼 실제 결제 이후에 독립적으로 수행해도 되는 작업은 비동기로 날려도 된다. (이벤트성 메시지 등 ..) => 슈퍼마켓 등에 도입 고려

+ 기본적으로 레스트로 다 써보고 이벤트 브로커, 메시지 브로커 등 고민해보기.
+ 사용자 많아진다고 하면 재고를 분산 캐시로 해서 줄여주고 늘려준다고 하면 부하를 만이 줄일 수도 있으니 고민해보기
```


## 12. 메시지 발송 이력 관리하는 테이블을 구성하는 2가지 방법에 대한 의사결정 기준
```
이력을 쌓는 방법 VS 계약번호대로 업데이트 치는 방법

- 요구사항에 따라 쿠팡 배달 기록처럼 기록이 남거나 로그성 적재가 필요한 경우 이력처럼 쌓아도 좋다. (비즈니스 측면 고민)
  + 다만 많아지면 디스크 용량 차지하지만 문제 발생시 원인 파악 용이
- 이벤트는 카프카 같은데 쌓고 실제 현재 배송 상태는 한줄로 해서 따로 나눠서 관리하는 방법도 있다.
(이벤트는 많으면 많을수록 좋지만 성능에 대한 고민을 하셔야한다.)
```


## 13. url에 고객 정보 암호화 해서 넣는 문제에 대한 의견
```
"url에 고객 정보를 암호화해서 넣는다."라는 건 "암호화 하는것과 안하는 것의 차이가 무엇이 있을까"에 대한 고민을 해보면 좋다.

Q. 예를 들어서 url에서 암호화된 고객 정보를 통해 사람을 체크하는 것의 보안적 차이가 무엇일까?
A. 저기서 원하는 건 이 url 접근하는 사람이 누구인지 알고싶은 것. 근데 내가 찬혁님 이름을 알면 url 구조만 알면 내 이름 넣어서 그냥 접근 가능. 여기서 암호화 하면 쉽게 url을 예측하긴 힘든 건 있음.

근데 만약 누군가 내 브라우저의 url을 본다거나 해당 url정보를 취득한 경우 누구나 나인척을 할 수 있는 건 똑같음. url 넣는거는 쿼리스트링 뿐이다.
암호화를 하는 건 쉬운 해킹은 불가능하게 하지만 그 여부와 상관없이 url만 탈취되도 나인척을 할 수 있다.


그래서 보안적으로 안전하려면 최소한
* 헤더등에 토큰을 만들어서 미리 인증을 받고 인증받은 토큰을 기준으로 토큰을 헤더같은데 넣어서 보내고 토큰은 돌아가면서 몇시간에 한번씩 리프레쉬를 해야한다.

```

## 14. 이 건 관련해서 양방향 암호화등의 키워드를 공부하는게 맞는 방향인지
```
SSL, 암호화등에 중요한거여서 물론 좋다.

- 퍼블릭키, 프라이빗 키, 암호화,
- 시메트릭(양쪽이 동일한 키로 암호화 하는 것), 에시메트릭(전혀 다른 프라이빗 퍼블릭키 암호화)들 사이의 장단점을 이해하는 것 좋다.
```


## 15. 그 외
```
코테 공부는 계속 하셔야하고 다음주에는 방황 끝에 얼마나 잘 돌아왔는지 확인할테니 열심히 해보길
```


오늘 하루도 공부할 수 있어 크게 감사합니다. 2024-05-16 개발자 최찬혁
